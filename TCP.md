# TCP

<hr>

## 拥塞控制

- 拥塞（congestion）：在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏，这种情况叫做拥塞。**若出现拥塞而不进行控制，整个网络的吞吐量讲随输入负荷的增大而下降。**

<img src=".\tcp\拥塞控制-吞吐量与输入负载关系.png" alt="image-20210128100608402" style="zoom: 33%;" />

- TCP的四种拥塞控制算法

  - 慢开始（slow-start）
  - 拥塞避免（congestion avoidance）
  - 快重传（fast retransmit）
  - 快恢复 (fast recovery)

  TCP Tahoe：慢开始、拥塞避免

  TCP Reno：快重传、快恢复 

  

  发送方维护一个叫做**拥塞窗口（cwnd）**的状态变量，其值取决于网络的拥塞程度，并且动态变化。

  	- 拥塞窗口cwnd的维护原则：只要网络没有出现拥塞，拥塞窗口就在增大一些，但只要网络出现拥塞，拥塞窗口就减少一些。
  	- 判断出现网络拥塞的依据：没有按时收到相应到达的确认报文报文（发生重传）。

  发送方将拥塞窗口作为发送窗口，即 **swnd=cwnd** 。

  发送方需要维护一个慢开始门限 **ssthresh** 状态变量：

  - 当 cwnd < ssthresh 时，使用慢开始算法；
  - 当 cwnd > ssthresh 时，停止使用慢开始算法，改而使用拥塞避免算法；
  - 当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法；
  - <img src=".\tcp\慢开始与拥塞避免.png" alt="image-20210129093328630" style="zoom: 50%;" />

### 慢开始

- 设置拥塞窗口 cwnd=1，设置慢慢开始门限值 ssthresh (这里取值为16)
- 发送窗口 swnd = 拥塞窗口 cwnd ，swnd有多大，就能发送多少个报文段。
- 发送方每收到对新报文段的确认时，就把拥塞窗口 cwnd 的值翻倍（正常来说，发送多少报文，接收到多少报文，cwnd += 接收报文数），cwnd成指数增长，然后进行下一轮的重输
- 当 cwnd = ssthresh（拥塞窗口达到慢开始门限值）时，停止使用慢开始算法，改用拥塞避免算法。

### 拥塞避免

- 拥塞避免算法时，每个传输轮次，cwnd加1，线性增长。
- 当出现重传时，ssthresh减半，cwnd=1，改为使用慢开始算法。

### 快重传

- 快重传，就是使发送方尽快重传，而不是等超时重传计时器超时再重传。
- 要求接收方不要等待自己发送数据时才进行捎带确认，而是要立即发送确认。
- 即使收到了失序的报文段也要立即对已收到的报文段重复确认。
- 发送方一旦收到3个连续重复确认，就将相应的报文段立即重传，而不是等该报文段的超时重传计时器超时再重传
- 对于个别丢失的报文段，发送方不会出现超时重传，也就不会误以为出现了拥塞（进而降低拥塞窗口cwnd为1）。
- 使用快重传可以使整个网络的吞吐量提高约20%。
- <img src=".\tcp\快重传.png" alt="image-20210129084333023" style="zoom: 50%;" />



### 快恢复

- 发送方一旦收到3个重复确认，就知道现在知识丢失了个别的报文段。于是不启动慢开始算法，而是执行快恢复算法。
- 更新ssthresh 减半，cwnd = ssthresh。

### 整个拥塞控制过程

<img src=".\tcp\TCP的拥塞控制过程.png" alt="image-20210129091319541" style="zoom: 80%;" />

<hr>













